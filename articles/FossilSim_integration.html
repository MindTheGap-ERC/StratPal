<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Integration with the FossilSim and paleotree packages • StratPal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Integration with the FossilSim and paleotree packages">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">StratPal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/StratPal.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/event_data.html">Stratigraphic Paleobiology for Event Data</a></li>
    <li><a class="dropdown-item" href="../articles/phenotypic_evolution.html">Stratigraphic Paleobiology for Phenotypic Evolution</a></li>
    <li><a class="dropdown-item" href="../articles/paleoTS_functionality.html">Usage with the paleoTS and evoTS package</a></li>
    <li><a class="dropdown-item" href="../articles/advanced_functionality.html">Advanced Functionality and Writing Extensions</a></li>
    <li><a class="dropdown-item" href="../articles/StratPal_docs.html">Documentation of defined S3 classes</a></li>
    <li><a class="dropdown-item" href="../articles/FossilSim_integration.html">Integration with the FossilSim and paleotree packages</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MindTheGap-ERC/StratPal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Integration with the FossilSim and paleotree packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MindTheGap-ERC/StratPal/blob/main/vignettes/FossilSim_integration.Rmd" class="external-link"><code>vignettes/FossilSim_integration.Rmd</code></a></small>
      <div class="d-none name"><code>FossilSim_integration.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mindthegap-erc.github.io/StratPal/">StratPal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MindTheGap-ERC/admtools" class="external-link">admtools</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette describes how to integrate the <code>StratPal</code>
package with the <code>FossilSim</code> and the <code>paleotree</code>
packages.</p>
<div class="section level2">
<h2 id="integration-with-the-fossilsim-package">Integration with the <code>FossilSim</code> package<a class="anchor" aria-label="anchor" href="#integration-with-the-fossilsim-package"></a>
</h2>
<p>As is, the <code>StratPal</code> package handles <code>fossils</code>
objects as constructed by the <code>FossilSim</code> package. These
objects represent fossils sampled along a tree (phylogeny). They can be
transformed using the functions <code>apply_taphonomy</code> and
<code>apply_niche</code>. This will remove fossil occurrences according
to preservation potential and change on taphonomic conditions (or niche
definition and change in gradient). Note that this corresponds to an
nonparametric expansion of the variable recovery model as implemented in
<code>FossilSim</code>.</p>
<p>As example, we examine the preservation of a phylogenetic tree with
taxonomy and sampled fossils 12 km from shore in a carbonate
platform.</p>
<div class="section level3">
<h3 id="stratigraphic-basis">Stratigraphic basis<a class="anchor" aria-label="anchor" href="#stratigraphic-basis"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct age-depth model</span></span>
<span><span class="va">adm_12km</span> <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/tp_to_adm.html" class="external-link">tp_to_adm</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">scenarioA</span><span class="op">$</span><span class="va">t_myr</span>,   <span class="co"># 12 km from shore</span></span>
<span>                h <span class="op">=</span> <span class="va">scenarioA</span><span class="op">$</span><span class="va">h_m</span><span class="op">[</span>,<span class="st">"12km"</span><span class="op">]</span>,</span>
<span>                T_unit <span class="op">=</span> <span class="st">"Myr"</span>,</span>
<span>                L_unit <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm_12km</span>, lty_destr <span class="op">=</span> <span class="fl">0</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Age-depth model 12 km from shore"</span>,</span>
<span>     lwd_destr <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/T_axis_lab.html" class="external-link">T_axis_lab</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/L_axis_lab.html" class="external-link">L_axis_lab</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-2-1.png" alt="Age-depth model and water depth 12 km offshore (proximal slope)" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># water depth 12 km from shore</span></span>
<span><span class="va">t</span> <span class="op">=</span> <span class="va">scenarioA</span><span class="op">$</span><span class="va">t_myr</span></span>
<span><span class="va">wd</span> <span class="op">=</span> <span class="va">scenarioA</span><span class="op">$</span><span class="va">wd_m</span><span class="op">[</span>,<span class="st">"12km"</span><span class="op">]</span></span>
<span><span class="va">gc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">wd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t</span>, <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time [Myr]"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Water depth [m]"</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-2-2.png" alt="Age-depth model and water depth 12 km offshore (proximal slope)" width="700"></p>
</div>
<div class="section level3">
<h3 id="trees-with-fossils">Trees with fossils<a class="anchor" aria-label="anchor" href="#trees-with-fossils"></a>
</h3>
<p>For the biological components, we simulate a tree with taxonomy and
fossils in the time domain using <code>FossilSim</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="co"># simulate phylogenetic tree</span></span>
<span><span class="va">tree</span> <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/rlineage.html" class="external-link">rbdtree</a></span><span class="op">(</span>birth <span class="op">=</span> <span class="fl">3</span>, death <span class="op">=</span> <span class="fl">1</span>, Tmax <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># simulate taxonomy along the tree</span></span>
<span><span class="va">s</span> <span class="op">=</span> <span class="fu">FossilSim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FossilSim/man/sim.taxonomy.html" class="external-link">sim.taxonomy</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">tree</span><span class="op">)</span></span>
<span><span class="co"># simulate fossils based on taxonomy</span></span>
<span><span class="va">sampling_rate</span> <span class="op">=</span> <span class="fl">40</span> <span class="co"># high sampling rate</span></span>
<span><span class="va">f</span> <span class="op">=</span> <span class="fu">FossilSim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FossilSim/man/sim.fossils.poisson.html" class="external-link">sim.fossils.poisson</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="va">sampling_rate</span>, taxonomy <span class="op">=</span> <span class="va">s</span><span class="op">)</span></span>
<span><span class="co"># plot tree with taxonomy and fossil times</span></span>
<span><span class="fu">FossilSim</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/FossilSim/man/plot.fossils.html" class="external-link">plot.fossils</a></span><span class="op">(</span><span class="va">f</span>, tree <span class="op">=</span> <span class="va">tree</span>, taxonomy <span class="op">=</span> <span class="va">s</span>, show.taxonomy <span class="op">=</span> <span class="cn">TRUE</span>, rho <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-3-1.png" alt="Phylogenetic tree with sampled fossils" width="700"></p>
</div>
<div class="section level3">
<h3 id="ecological-effects">Ecological effects<a class="anchor" aria-label="anchor" href="#ecological-effects"></a>
</h3>
<p>Lets assume all taxa have identical niches and a preferred water
depth of around 60 m, and are rather tolerant to fluctuations in water
depth:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define niche</span></span>
<span><span class="va">my_niche</span> <span class="op">=</span> <span class="fu"><a href="../reference/snd_niche.html">snd_niche</a></span><span class="op">(</span>opt <span class="op">=</span> <span class="fl">60</span>, tol <span class="op">=</span> <span class="fl">40</span>, cutoff_val <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot niche</span></span>
<span><span class="va">wd_p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wd_p</span>,</span>
<span>     y <span class="op">=</span> <span class="fu">my_niche</span><span class="op">(</span><span class="va">wd_p</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Water depth [m]"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Collection probability"</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Collection probability with water depth"</span>,</span>
<span>     lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-4-1.png" alt="Niche of taxa and collection probability with time" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/get_T_tp.html" class="external-link">get_T_tp</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">adm_12km</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/get_T_tp.html" class="external-link">get_T_tp</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">my_niche</span><span class="op">(</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time [Myr]"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Collection probability"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Collection probability with time"</span>,</span>
<span>     lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-4-2.png" alt="Niche of taxa and collection probability with time" width="700"></p>
<p>After accounting for niches, the tree with niches looks like</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_niche</span> <span class="op">=</span> <span class="va">f</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/apply_niche.html">apply_niche</a></span><span class="op">(</span>niche_def <span class="op">=</span> <span class="va">my_niche</span>, gc <span class="op">=</span> <span class="va">gc</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># plot tree after accounting for taxon niches</span></span>
<span><span class="fu">FossilSim</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/FossilSim/man/plot.fossils.html" class="external-link">plot.fossils</a></span><span class="op">(</span><span class="va">f_niche</span>, <span class="va">tree</span>, taxonomy <span class="op">=</span> <span class="va">s</span>, show.taxonomy <span class="op">=</span> <span class="cn">TRUE</span>, rho <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-5-1.png" alt="Tree with fossils after accounting for niche preference" width="700"></p>
<p>Note that although there are many more lineages present at the end of
the simulation, there are fewer fossils recovered. This is because the
water depth is too low (the platform is drowning) to actually observe
the taxa. Note that the <code>apply_niche</code> function is only
applied to the <code>fossils</code> object and not to the tree and the
taxonomy object, as they are not influenced by niche preferences.</p>
</div>
<div class="section level3">
<h3 id="stratigraphic-effects">Stratigraphic effects<a class="anchor" aria-label="anchor" href="#stratigraphic-effects"></a>
</h3>
<p>Now let us examine how the tree would be observed in the
stratigraphic domain:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## transform tree, fossils, and taxonomy into stratigraphyc domain</span></span>
<span><span class="co"># using the age-depth model</span></span>
<span><span class="va">tree_strat</span> <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">adm_12km</span><span class="op">)</span> <span class="co"># no transformation of time to age required</span></span>
<span><span class="va">s_strat</span> <span class="op">=</span> <span class="va">s</span> <span class="op">|&gt;</span>  <span class="co"># taxonomy object in the time domain</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># convert age to time</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span> <span class="va">adm_12km</span> , destructive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># transform using age-depth model</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_height.html" class="external-link">max_height</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span><span class="op">)</span> <span class="co"># transform back into age</span></span>
<span><span class="va">f_strat</span> <span class="op">=</span>  <span class="va">f</span> <span class="op">|&gt;</span> <span class="co"># same here</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm_12km</span> <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span> <span class="va">adm_12km</span> , destructive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">|&gt;</span> <span class="co"># destroy fossils coinciding with gaps</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_height.html" class="external-link">max_height</a></span><span class="op">(</span><span class="va">adm_12km</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">FossilSim</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/FossilSim/man/plot.fossils.html" class="external-link">plot.fossils</a></span><span class="op">(</span><span class="va">f_strat</span>, </span>
<span>                         tree <span class="op">=</span> <span class="va">tree_strat</span>,</span>
<span>                         taxonomy <span class="op">=</span> <span class="va">s_strat</span>,</span>
<span>                         show.taxonomy <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                         rho <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         show.axis <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Stratigraphic position [m]"</span>, line <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-6-1.png" alt="Tree with fossils in the stratigraphic domain" width="700"></p>
<p>The accumulation of fossils on the right side is due to the
stratigraphic condensation observable at 12 m height in the age-depth
model.</p>
</div>
<div class="section level3">
<h3 id="combined-stratigraphic-and-ecological-effects">Combined stratigraphic and ecological effects<a class="anchor" aria-label="anchor" href="#combined-stratigraphic-and-ecological-effects"></a>
</h3>
<p>Naturally, both ecological and stratigraphic effects can be combined
by applying the niche model to the <code>fossils</code> object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## transform tree, fossils, and taxonomy into stratigraphyc domain</span></span>
<span><span class="co"># using the age-depth model</span></span>
<span><span class="va">tree_strat</span> <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">adm_12km</span><span class="op">)</span> <span class="co"># no transformation of time to age required</span></span>
<span><span class="va">s_strat</span> <span class="op">=</span> <span class="va">s</span> <span class="op">|&gt;</span>  <span class="co"># taxonomy object in the time domain</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># convert age to time</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span> <span class="va">adm_12km</span> , destructive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># transform using age-depth model</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_height.html" class="external-link">max_height</a></span><span class="op">(</span><span class="va">adm_12km</span><span class="op">)</span><span class="op">)</span> <span class="co"># transform back into age</span></span>
<span><span class="va">f_strat</span> <span class="op">=</span>  <span class="va">f</span> <span class="op">|&gt;</span> <span class="co"># same here</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm_12km</span> <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/apply_niche.html">apply_niche</a></span><span class="op">(</span>niche_def <span class="op">=</span> <span class="va">my_niche</span>, gc <span class="op">=</span> <span class="va">gc</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># apply niche model </span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span> <span class="va">adm_12km</span> , destructive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">|&gt;</span> <span class="co"># destroy fossils coinciding with gaps</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">rev_dir</a></span><span class="op">(</span>ref <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_height.html" class="external-link">max_height</a></span><span class="op">(</span><span class="va">adm_12km</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">FossilSim</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/FossilSim/man/plot.fossils.html" class="external-link">plot.fossils</a></span><span class="op">(</span><span class="va">f_strat</span>,</span>
<span>                         tree <span class="op">=</span> <span class="va">tree_strat</span>,</span>
<span>                         taxonomy <span class="op">=</span> <span class="va">s_strat</span>,</span>
<span>                         show.taxonomy <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                         rho <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         show.axis <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Stratigraphic position [m]"</span>, line <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="FossilSim_integration_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Trees and taxomony object are not modified by
<code>apply_niche</code> and <code>apply_taphonomy</code>, as they are
are not subject to sampling effects.</p>
</div>
<div class="section level3">
<h3 id="technical-notes">Technical notes<a class="anchor" aria-label="anchor" href="#technical-notes"></a>
</h3>
<p><code>FossilSim</code> uses age relative to the present, whereas
<code>admtools</code> uses time. The function
<code><a href="https://mindthegap-erc.github.io/admtools/reference/rev_dir.html" class="external-link">admtools::rev_dir</a></code> accounts for this by reversing time to
age and the other way around (relative to a reference point). Use this
function on all object produced by <code>FossilSim</code> before
entering and after leaving the <code>admtools</code> and
<code>StratPal</code> ecosystem.</p>
<p>By default, axis labels of <code>FossilSim</code> are “Time before
the present”. In the context of <code>StratPal</code> and
<code>admtools</code> this is misleading, as the present might refer to
the end of the observation/the highest stratigraphic point. As of now,
no option to override the default axis labels are available. For correct
axis labels, set <code>show.axis = FALSE</code> and manually create the
axis using <code>axis</code> and <code>mtext</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="integration-with-paleotree">Integration with <code>paleotree</code><a class="anchor" aria-label="anchor" href="#integration-with-paleotree"></a>
</h2>
<p>To combine the <code>StratPal</code> package with the
<code>paleotree</code> package, please convert the
<code>paleotree</code> format into the <code>FossilSim</code> format as
described in the <code>paleotree</code> vignette of the
<code>FossilSim</code> vignette:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"paleotree"</span>, package <span class="op">=</span> <span class="st">"FossilSim"</span><span class="op">)</span></span></code></pre></div>
<p>After conversion you can proceed as described in the section
<em>Integration with the <code>FossilSim</code> package</em></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Barido-Sottani J, Pett W, O’Reilly JE, Warnock RCM. Fossilsim: An r
package for simulating fossil occurrence data under mechanistic models
of preservation and recovery. Methods Ecol Evol. 2019; 10: 835–840. <a href="https://doi.org/10.1111/2041-210X.13170" class="external-link uri">https://doi.org/10.1111/2041-210X.13170</a>
</li>
<li>Bapst, D.W. (2012), paleotree: an R package for paleontological and
phylogenetic analyses of evolution. Methods in Ecology and Evolution, 3:
803-807. <a href="https://doi.org/10.1111/j.2041-210X.2012.00223.x" class="external-link uri">https://doi.org/10.1111/j.2041-210X.2012.00223.x</a>
</li>
<li>Warnock R, Barido-Sottani J, Pett W, Joseph O, Stolz U (2024).
<em>FossilSim: Simulation and Plots for Fossil and Taxonomy Data</em>. R
package version 2.4.1, <a href="https://CRAN.R-project.org/package=FossilSim" class="external-link uri">https://CRAN.R-project.org/package=FossilSim</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niklas Hohmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
