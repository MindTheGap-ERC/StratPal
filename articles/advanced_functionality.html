<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Functionality and Writing Extensions • StratPal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Functionality and Writing Extensions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">StratPal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/StratPal.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced_functionality.html">Advanced Functionality and Writing Extensions</a></li>
    <li><a class="dropdown-item" href="../articles/event_data.html">Stratigraphic Paleobiology for Event Data</a></li>
    <li><a class="dropdown-item" href="../articles/phenotypic_evolution.html">Stratigraphic Paleobiology for Phenotypic Evolution</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MindTheGap-ERC/StratPal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced Functionality and Writing Extensions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MindTheGap-ERC/StratPal/blob/main/vignettes/advanced_functionality.Rmd" class="external-link"><code>vignettes/advanced_functionality.Rmd</code></a></small>
      <div class="d-none name"><code>advanced_functionality.Rmd</code></div>
    </div>

    
    
<p>Here we go through how the presented workflows can be generalized and
expanded upon.</p>
<div class="section level2">
<h2 id="different-forward-models">Different forward models<a class="anchor" aria-label="anchor" href="#different-forward-models"></a>
</h2>
<p>In the examples, we used age-depth models from a carbonate platform
simulated with CarboCAT lite (<a href="#References">Burgess 2013</a>, <a href="#References">Burgess 2023</a>). This can easily be expanded to any
other sedimentary forward model (be it marine or terrestrial,
siliciclastic, mixed, or carbonate system).</p>
<p>For this, age-depth information needs to be extracted from the
forward model. The vectors of elapsed model time vs. accumulated height
can then be handed over to <code>tp_to_adm</code> to define age-depth
model objects. These can then be used in the pipelines as in the
examples.</p>
<p>If the forward model included erosion, you need to first account for
time intervals where sediment is first deposited and later removed. For
this, first define a sediment accumulation curve using
<code><a href="https://mindthegap-erc.github.io/admtools/reference/tp_to_sac.html" class="external-link">admtools::tp_to_sac</a></code>, and pass it to
<code><a href="https://mindthegap-erc.github.io/admtools/reference/sac_to_adm.html" class="external-link">admtools::sac_to_adm</a></code> to turn it into an age-depth model.
You can then use the resulting age-depth model for your analysis
pipeline.</p>
</div>
<div class="section level2">
<h2 id="empirical-age-depth-models">Empirical age-depth models<a class="anchor" aria-label="anchor" href="#empirical-age-depth-models"></a>
</h2>
<p>Of course you can use empirical age-depth models in your pipeline.
You can create them from tie points using <code>tp_to_adm</code> just as
in the case with forward models.</p>
<p>The workflow in <code>StratPal</code> does not work with
<code>multiadm</code> objects as defined by <code>admtools</code>. These
objects store multiple age-depth models to account for uncertainty. You
can however reduce their complexity, e.g. via
<code><a href="https://mindthegap-erc.github.io/admtools/reference/median_adm.html" class="external-link">admtools::median_adm</a></code>, and use the resulting age-depth
model.</p>
</div>
<div class="section level2">
<h2 id="other-ecological-gradients-and-niche-definitions">Other ecological gradients and niche definitions<a class="anchor" aria-label="anchor" href="#other-ecological-gradients-and-niche-definitions"></a>
</h2>
<p>In the examples we used water depth as ecological gradient. The
approach for niche modeling used in <code>StratPal</code> works for all
types of niches and gradient. Potentially relevant gradients that can be
extracted from forward models are for example substrate consistency,
temperature, or water energy.</p>
<p>We used a simple niche definition based on a probability density
function of a normal distribution implemented in <code>snd_niche</code>.
This can be expanded to arbitrary niche definitions along a gradient.
For integration with <code>apply_niche</code>, niche definitions must
meet the following criteria:</p>
<ol style="list-style-type: decimal">
<li>They are functions that take gradient values as input and return
numbers between 0 and 1 as outputs.</li>
<li>They are vectorized, meaning when handed a vector, they return a
vector of equal length.</li>
</ol>
<p>Similar criteria hold for the definitions of gradient change
<code>gc</code>:</p>
<ol style="list-style-type: decimal">
<li>
<code>gc</code> must be a function that takes time (or position) as
input, and returns gradient values as outputs.</li>
<li>The function must be vectorized, meaning when handed a vector, it
must return a vector of equal length.</li>
</ol>
<p>As long as these conditions for <code>gc</code> and
<code>niche_def</code> are met, arbitrary niche preferences along any
gradient can be modeled using <code>apply_niche</code>.</p>
</div>
<div class="section level2">
<h2 id="different-models-of-phenotypic-evolution">Different models of phenotypic evolution<a class="anchor" aria-label="anchor" href="#different-models-of-phenotypic-evolution"></a>
</h2>
<p>Other types of phenotypic evolution in the time domain can easily be
incorporated. For seamless integration, they need to meet the following
criteria:</p>
<ul>
<li><p>They take a vector of times as first argument</p></li>
<li><p>The implementation is for a continuous time version of the mode
of interest, as the time domain is generally sampled at irregular times
(see methods section in <a href="#References">Hohmann et al. (2024)</a>
for details). More specifically, the implementation must be able to deal
with heterodistant sampling in time.</p></li>
<li><p>They return a list with two elements: One named <code>t</code>
that is a duplicate of the first argument handed to the function. The
second one should be named <code>y</code> and contain the simulated
trait values.</p></li>
<li><p>The output list <code>l</code> should be assigned both the class
“list” and “timelist” via the command
<code>class(l) = c("timelist", "list")</code> , see the source code of
<code>random_walk</code> for an example.</p></li>
</ul>
<p>The last two points make sure plotting via
<code><a href="https://mindthegap-erc.github.io/admtools/reference/plot.timelist.html" class="external-link">admtools::plot.timelist</a></code> and
<code><a href="https://mindthegap-erc.github.io/admtools/reference/plot.stratlist.html" class="external-link">admtools::plot.stratlist</a></code> works seamlessly.</p>
</div>
<div class="section level2">
<h2 id="different-models-of-event-type-data">Different models of event type data<a class="anchor" aria-label="anchor" href="#different-models-of-event-type-data"></a>
</h2>
<p>We used (constant and variable rate) Poisson point processes to
simulate event type data. Any model of event-type data can be used
(e.g., one with temporal correlation), as long as it returns a vector
with the timing/position of the events.</p>
</div>
<div class="section level2">
<h2 id="transforming-data-from-the-stratigraphic-domain-to-the-time-domain">Transforming data from the stratigraphic domain to the time
domain<a class="anchor" aria-label="anchor" href="#transforming-data-from-the-stratigraphic-domain-to-the-time-domain"></a>
</h2>
<p>Much of the explanations here focus on forward modeling, i.e.,
modeling the time domain and examining how it is expressed in the
stratigraphic domain. The reverse direction (from the stratigraphic
domain to the time domain) can be modeled using
<code>strat_to_time</code>.</p>
</div>
<div class="section level2">
<h2 id="taphonomy-for-event-type-data">Taphonomy for event type data<a class="anchor" aria-label="anchor" href="#taphonomy-for-event-type-data"></a>
</h2>
<p>Taphonomic effects can be incorporated using using the
<code>apply_taphonomy</code> function. This is based on the same
principle as niche modeling, and makes use of the <code>thin</code>
function, but was not shown in the examples. For
<code>pres_potential</code> (resp. <code>ctc</code>), the same logical
constraints apply as to <code>niche_def</code> (resp.
<code>gc</code>).</p>
</div>
<div class="section level2">
<h2 id="transform-different-types-of-data">Transform different types of data<a class="anchor" aria-label="anchor" href="#transform-different-types-of-data"></a>
</h2>
<p><code>strat_to_time</code> and <code>time_to_strat</code> are generic
functions of the <code>admtools</code> package that can transform
different types of data. Currently they transform phylogenetic trees
(<code>phylo</code> objects), lists (<code>list</code> class), and
numeric data such as the event type data (class
<code>numeric</code>).</p>
<p>In general, any type of temporal (resp. stratigraphic) data can be
transformed. For this, you need define a <code>S3</code> class for the
object you would like to transform (if it does not already have a S3
class), and then implement the transformation of this class for
<code>time_to_strat</code> and <code>strat_to_time</code>.</p>
<p>If you would like to add transformations for new S3 classes to the
<code>admtools</code> package, please see the contribution guidelines
(CONTRIBUTING.md file) of the <code>admtools</code> package for details
on how to contribute code.</p>
</div>
<div class="section level2">
<h2 id="References">References<a class="anchor" aria-label="anchor" href="#References"></a>
</h2>
<ul>
<li><p>Burgess, Peter. 2013. “CarboCAT: A cellular automata model of
heterogeneous carbonate strata.” Computers &amp; Geosciences. <a href="https://doi.org/10.1016/j.cageo.2011.08.026" class="external-link uri">https://doi.org/10.1016/j.cageo.2011.08.026</a>.</p></li>
<li><p>Burgess, Peter. 2023. “CarboCATLite v1.0.1.” Zenodo. <a href="https://doi.org/10.5281/zenodo.8402578" class="external-link uri">https://doi.org/10.5281/zenodo.8402578</a></p></li>
<li><p>Hohmann, Niklas; Koelewijn, Joël R.; Burgess, Peter; Jarochowska,
Emilia. 2024. “Identification of the mode of evolution in incomplete
carbonate successions.” BMC Ecology and Evolution, In Press. <a href="https://doi.org/10.1101/2023.12.18.572098" class="external-link uri">https://doi.org/10.1101/2023.12.18.572098</a>.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niklas Hohmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
