<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>trait_evolution • StratPal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="trait_evolution">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">StratPal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/StratPal.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fossil_occ.html">Stratigraphic Paleobiology for fossil occurrences</a></li>
    <li><a class="dropdown-item" href="../articles/trait_evolution.html">trait_evolution</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MindTheGap-ERC/StratPal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>trait_evolution</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MindTheGap-ERC/StratPal/blob/main/vignettes/trait_evolution.Rmd" class="external-link"><code>vignettes/trait_evolution.Rmd</code></a></small>
      <div class="d-none name"><code>trait_evolution.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mindthegap-erc.github.io/StratPal/">StratPal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MindTheGap-ERC/admtools" class="external-link">admtools</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here we describe the modeling pipeline for the stratigraphic
paleobiology of trait evolution.</p>
</div>
<div class="section level2">
<h2 id="time-domain">Time domain<a class="anchor" aria-label="anchor" href="#time-domain"></a>
</h2>
<p>The <code>StratPal</code> package provides three functions for
simulating trait evolution in the time domain:</p>
<ul>
<li><p><code>stasis</code> simulates evolutionary stasis as independent,
normally distributed random variables with mean <code>mean</code> and
standard deviation <code>sd</code>.</p></li>
<li><p><code>random_walk</code> simulates trait evolution following a
(potentially biased) random walk with variability <code>sigma</code>,
directionality <code>mu</code>, and initial trait value <code>y0</code>.
Setting <code>mu</code> to a negative (positive) value will make the
random walk increase (decrease) over time, <code>sigma</code> determines
the effect of randomness on the trait values.</p></li>
<li><p><code>ornstein_uhlenbeck</code> corresponds to convergence to a
phenotypic optimum, where <code>mu</code> is the optimal value (long
term mean), <code>theta</code> determines the strength of selection,
<code>sigma</code> the influence of chance, and <code>y0</code> the
initial trait value.</p></li>
</ul>
<p>You can visualize them using the following pipeline:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># times of simulation in myr. simulate over 1 Myr years with 10 kyr resolution</span></span>
<span>  <span class="fu"><a href="../reference/random_walk.html">random_walk</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">1</span>, mu <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># simulate random walk with incresing trait values</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"l"</span>, <span class="co"># plot results</span></span>
<span>       xlab <span class="op">=</span> <span class="st">"Time [Myr]"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"Trait value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="trait_evolution_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="stratigraphic-domain">Stratigraphic domain<a class="anchor" aria-label="anchor" href="#stratigraphic-domain"></a>
</h2>
<p>We are interested in the stratigraphic expression of phenotypic
evolution, i.e. how is trait evolution within a lineage preserved at a
specific location in the stratigraphic record.</p>
<p>For this, we first define an age-depth model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define ADM 4 km from shore</span></span>
<span><span class="va">dist</span> <span class="op">=</span> <span class="va">scenarioA</span><span class="op">$</span><span class="va">dist_from_shore</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">adm</span> <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/tp_to_adm.html" class="external-link">tp_to_adm</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">scenarioA</span><span class="op">$</span><span class="va">t_myr</span>,</span>
<span>                h <span class="op">=</span> <span class="va">scenarioA</span><span class="op">$</span><span class="va">h_m</span><span class="op">[</span>,<span class="va">dist</span><span class="op">]</span>,</span>
<span>                T_unit <span class="op">=</span> <span class="st">"Myr"</span>,</span>
<span>                L_unit <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span>
<span><span class="co"># plot age-depth model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">adm</span>,</span>
<span>     lwd_acc <span class="op">=</span> <span class="fl">2</span>,   <span class="co"># plot thicker lines for accumulative intervals (lwd = line width)</span></span>
<span>     lty_destr <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># don't plot destructive intervals (lty = line type)</span></span>
<span><span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/T_axis_lab.html" class="external-link">T_axis_lab</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># add time axis label</span></span>
<span><span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/L_axis_lab.html" class="external-link">L_axis_lab</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># add length axis label</span></span></code></pre></div>
<p><img src="trait_evolution_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Now we can use the age-depth model to transform the simulated trait
values from the time domain into the depth domain using
<code>time_to_strat</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample every 10 kyr over the interval covered by the adm </span></span>
<span><span class="co"># simulate random walk</span></span>
<span><span class="co"># transform data from time to strat domain</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/min_time.html" class="external-link">min_time</a></span><span class="op">(</span><span class="va">adm</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_time.html" class="external-link">max_time</a></span><span class="op">(</span><span class="va">adm</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="../reference/random_walk.html">random_walk</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">1</span>, mu <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># simulate random walk</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span><span class="va">adm</span>, destructive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>       orientation <span class="op">=</span> <span class="st">"lr"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"Stratigraphic height [m]"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"Trait value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="trait_evolution_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Here we can already see the large jumps in trait values over the
gaps, because we are missing a lot of time.</p>
<p>This is already a good start, but there are some small issues:
Because we simulate the lineage every 10 kyr, the lineage is sampled
irregular in the stratigraphic domain. For example, we get multiple
conflicting trait values at height with gaps longer than 10 kyr. To get
a more realistic result, we need to prescribe a sampling strategy in the
stratigraphic domain. We do this in the following steps:</p>
<ol style="list-style-type: decimal">
<li>Determine sampling locations</li>
<li>Calculate what times correspond to said sampling locations via
<code>strat_to_time</code>
</li>
<li>Simulate a lineage at said times</li>
<li>Transform the simulated trait values back into the stratigraphic
domain using <code>time_to_strat</code>
</li>
<li>Plot the result</li>
</ol>
<p>Let’s assume we take a sample every 2 meters. Then our five steps
above result in the following modeling pipeline:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist_between_samples_m</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">sampling_loc_m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">dist_between_samples_m</span>,</span>
<span>                     to <span class="op">=</span> <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/max_height.html" class="external-link">max_height</a></span><span class="op">(</span><span class="va">adm</span><span class="op">)</span>,</span>
<span>                     by <span class="op">=</span> <span class="va">dist_between_samples_m</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sampling_loc_m</span> <span class="op">|&gt;</span>         <span class="co"># sampling locations</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/strat_to_time.html" class="external-link">strat_to_time</a></span><span class="op">(</span><span class="va">adm</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="co"># determine times where lineage is sampled</span></span>
<span>  <span class="fu"><a href="../reference/random_walk.html">random_walk</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">1</span>, mu <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># simulate trait values at these times</span></span>
<span>  <span class="fu"><a href="https://mindthegap-erc.github.io/admtools/reference/time_to_strat.html" class="external-link">time_to_strat</a></span><span class="op">(</span><span class="va">adm</span>, destructive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="co"># transform trait values to stratigraphic domain</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>orientation <span class="op">=</span> <span class="st">"lr"</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>,        <span class="co"># plot fossil time series</span></span>
<span>       ylab <span class="op">=</span> <span class="st">"Trait Value"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"Stratigraphic Height [m]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="trait_evolution_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>There we have it! This is what the lineage would look like if it
would be sampled every 2 meters in a sections 2 km offshore. You nicely
see the large jumps over the prolonged hiatuses.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niklas Hohmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
